#include "Riostream.h"
#include <TROOT.h>
#include "TMinuit.h"
#include "TMath.h"
#include "TRandom1.h"
#include <ctime>

std::clock_t start = std::clock();
int s = (std::clock() - start) / (double) (CLOCKS_PER_SEC );
int sector = 6;


double calculate_residual(int sector, int i, double *par) {
	// nominal shifts by Raffaella de Vita were shifts of 0.2 cm and rotations of 0.1 degrees
	// may need to update these values in future
	double shift = 0.2;
	double rot = 0.2;

	// values in these lists are in micrometers
	// rotations around x and z axis are negligible when compared to other rotations so we do
	// not use them

	double r1_z_list[37] = {311.596, 296.91, 345.662, 281.889, 308.389, 390.018, 254.571, 
		285.247, 267.502, 276.939, 251.341, 252.164, -146.782, -154.717, 
		-131.329, -136.653, -103.844, -133.29, -175.522, -196.828, -153.601, 
		-139.903, -175.83, -165.717, 60.0241, 57.6952, 55.8587, 58.8278, 
		24.5592, 55.6473, 24.2369, 27.126, 48.8597, 41.6006, 37.0651, 89.5338, 0};
	double r2_z_list[37] = {-521.971, -548.544, -527.642, -533.472, -582.077, -563.04, -502.122, 
		-535.821, -519.498, -508.676, -501.179, -535.36, 269.489, 291.16, 
		307.244, 273.598, 299.968, 312.822, 323.221, 319.807, 315.168, 
		362.616, 327.05, 341.402, -105.699, -102.958, -85.6919, -89.0593, 
		-103.78, -84.4495, -122.026, -145.611, -107.894, -89.4951, -92.6001, 
		-68.4147, 0};
	double r3_z_list[37] = {289.166, 274.336, 318.367, 273.446, 272.072, 296.639, 249.609, 
		253.891, 267.637, 267.989, 238.168, 214.885, -117.811, -104.436, 
		-98.274, -130.537, -128.926, -141.652, -154.27, -172.45, -168.063, 
		-137.95, -188.144, -195.332, 89.9769, 78.6268, 66.5107, 48.3941, 
		21.0159, 26.9363, 73.0541, 25.7347, 50.4945, 57.1074, 32.0057, 49.095, 0};

	double r1_z_list_1[37] = {-1423.32, -1446.49, -1423.7, -1396.53, -1387.23, -1471.15, -1345.03, 
		-1396.7, -1401.77, -1326.42, -1344.97, -1420.84, 986.282, 1011.76, 
		1019.49, 890.544, 851.428, 956.421, 1084.58, 1094.84, 950.93, 
		1013.15, 1002.2, 971.668, -252.683, -283.271, -353.488, -298.472, 
		-436.229, -478.401, -247.543, -346.721, -255.008, -297.277, -344.145, 
		-321.032, 0};
	double r1_z_list_2[37] = {1.57832, -172.491, -224.394, -81.5278, -629.064, -570.57, -530.442, 
		-609.588, -608.3, -574.458, -586.355, -649.862, 454.837, 369.068, 
		367.21, 358.179, 470.725, 405.047, 429.461, 421.293, 453.323, 
		370.256, 336.188, 382.713, -95.3226, -113.532, -152.974, -128.96, 
		-214.843, -170.601, -68.1284, -153.669, -74.8459, -61.9708, -111.779, 
		-85.7292, 0};
	double r1_z_list_3[37] = {895.593, 885.459, 944.247, 904.848, 934.305, 925.184, 899.047, 
		901.244, 958.845, 999.997, 948.663, 1021.02, -363.343, -358.873, 
		-312.136, -293.958, -362.331, -352.682, -707.454, -744.994, -665.983, 
		-620.214, -676.011, -638.804, 95.2031, 14.1644, 134.012, 110.914, 
		222.652, 193.016, 173.286, 186.982, 107.767, 281.496, 273.859, 
		236.579, 0};
	double r1_z_list_4[37] = {2062.68, 2057.44, 2142.1, 2159.55, 2115.92, 2099.3, 1701.31, 
		1707.95, 1874.85, 1819.53, 1871.69, 1905.42, -1150.75, -1054.79, 
		-967.66, -1002.26, -967.868, -992.106, -1189.41, -1157.01, -1094.56, 
		-1089.09, -1127.78, -1077.68, 324.964, 331.633, 416.88, 406.127, 
		406.656, 443.966, 237.252, 272.384, 333.398, 320.038, 360.943, 
		390.882, 0};
	double r1_z_list_5[37] = {1018.35, 1037.23, 1048.17, 1064.69, 1101.75, 1065.33, 736.026, 
		778.385, 754.676, 831.521, 796.083, 783.814, -678.376, -678.393, 
		-605.677, -578.984, -598.134, -600.219, -497.759, -437.311, -456.331, 
		-357.09, -435.146, -411.206, 204.704, 268.815, 145.003, 229.208, 
		276.296, 244.394, 92.6204, 32.9776, 94.335, 47.2864, 113.879, 191.672, 0};
	double r1_z_list_6[37] = {-980.406, -957.987, -914.243, -956.928, -995.629, -934.467, -861.61, 
		-994.008, -978.967, -1050.4, -1019.12, -1112.78, 389.003, 434.209, 
		335.408, 282.186, 376.289, 394.8, 725.372, 669.815, 604.191, 718.305, 
		634.283, 634.854, -76.5597, -91.5248, -46.2562, -137.418, -219.954, 
		-122.875, -197.424, -194.24, -211.289, -206.035, -243.503, -265.407, 0};

	double r2_z_list_1[37] = {3044.74, 3034.17, 3148.16, 3201.29, 3200.63, 3116.3, 2944.93, 
		2897.28, 2912.56, 3105.55, 2962.83, 2909.51, -1829.72, -1805.6, 
		-1728.12, -1844.31, -1914.07, -1911.95, -1929.46, -1971.55, -1992.1, 
		-1999.9, -2031.92, -2105.57, 784.83, 793.468, 714.006, 715.621, 
		573.097, 555.729, 682.767, 592.415, 664.817, 546.359, 596.102, 
		584.303, 0};
	double r2_z_list_2[37] = {2229.22, 2279.06, 2375.96, 2059.59, 1704.87, 1743.2, 1439.94, 
		1458.16, 1428.59, 1463.35, 1431.26, 1377.71, -663.779, -779.608, 
		-774.938, -796.919, -729.746, -825.354, -822.198, -833.956, -785.438, 
		-858.52, -920.075, -873.891, 374.279, 331.096, 273.692, 239.293, 
		153.954, 204.569, 339.551, 208.212, 303.564, 267.884, 262.367, 
		316.748, 0};
	double r2_z_list_3[37] = {-790.093, -892.78, -851.676, -822.093, -662.605, -805.732, -862.055, 
		-996.904, -873.452, -899.926, -788.609, -777.655, 674.484, 704.963, 
		696.531, 721.176, 685.49, 704.932, 1198.13, 1082.12, 1135.22, 
		1219.46, 1195.22, 1230.48, -288.517, -340.432, -211.1, -237.691, 
		-122.263, -142.371, -454.822, -445.658, -515.371, -342.805, -344.379, 
		-416.584, 0};
	double r2_z_list_4[37] = {-328.607, -467.342, -518.125, -518.017, -56.8298, -224.709, 
		-684.366, -823.498, -577.784, -831.056, -532.181, -403.709, 1664.03, 
		1708.12, 1739.82, 1728.1, 1820.63, 1779.22, 1780.8, 1687.44, 1607.07, 
		1779.25, 1752.55, 1893.66, -794.332, -728.107, -637.902, -645.47, 
		-648.054, -597.929, -759.575, -707.678, -599.164, -627.789, -629.976, 
		-572.896, 0};
	double r2_z_list_5[37] = {-2126.95, -2110.48, -2115.08, -2065.87, -2039.3, -2062.28, -1626.08, 
		-1545.28, -1613.13, -1551.87, -1550.43, -1592.72, 1177.99, 1149.55, 
		1151.05, 1172.79, 1204.38, 1228.07, 776.681, 817.98, 808.89, 868.158, 
		848.224, 880.36, -443.321, -379.61, -452.426, -362.501, -317.954, 
		-347.651, -252.755, -259.239, -248.058, -280.642, -209.858, -122.843, 0};
	double r2_z_list_6[37] = {1645.71, 1657.98, 1705.55, 1663.05, 1654.05, 1708.82, 1846.03,
		1775.17, 1772.32, 1722.88, 1783.88, 1639.11, -647.23, -540.065, 
		-632.488, -651.934, -635.857, -667.986, -1189.64, -1247.42, -1226.76, 
		-1129.09, -1219.56, -1285.17, 293.735, 284.227, 290.914, 191.254, 
		109.807, 208.199, 390.97, 402.555, 361.421, 417.091, 297.895, 333.291};

	double r3_z_list_1[37] = {-49.0949, -106.179, -96.4345, -129.213, -189.935, -167.364, 
		-172.733, -165.238, -195.394, -129.273, -179.119, -244.156, 136.158, 
		190.978, 246.4, 121.697, 120.797, 196.331, 219.79, 230.412, 162.949, 
		189.714, 208.151, 223.351, -91.8637, -47.5877, -79.5285, -24.5756, 
		-69.0471, -70.6064, -116.654, -184.658, -30.8271, -58.4106, -66.2459, 
		-16.1627, 0};
	double r3_z_list_2[37] = {235.687, 171.64, 179.775, 150.112, -37.8506, 131.879, 35.2803, 
		2.73493, -11.3253, 34.0429, -28.5979, -6.76388, 98.209, 23.4921, 
		45.7649, 31.2537, 142.242, 109.172, -7.05517, -5.00029, 53.219, 
		4.54087, -43.9233, 23.7468, -30.4801, -4.91576, -27.7956, -14.2427, 
		-68.5963, -19.0558, 26.5152, -62.7517, 28.5849, 35.9309, 20.7973, 
		74.3316, 0};
	double r3_z_list_3[37] = {456.984, 467.349, 477.504, 423.022, 456.602, 418.439, 437.009, 
		402.651, 481.376, 504.503, 433.091, 476.894, -138.103, -169.978, 
		-155.214, -140.31, -225.933, -256.931, -330.861, -370.174, -313.745, 
		-304.65, -370.29, -379.299, 96.3455, -7.52434, 106.232, 39.3273, 
		134.491, 66.8967, 159.357, 130.037, 27.4904, 161.674, 129.055, 28.761, 0};
	double r3_z_list_4[37] = {883.165, 839.052, 913.088, 893.634, 809.895, 809.172, 701.975, 
		727.142, 840.014, 739.391, 737.135, 748.184, -413.65, -375.834, 
		-341.452, -396.726, -407.393, -468.787, -465.264, -472.641, -474.364, 
		-495.74, -574.653, -557.088, 238.489, 207.718, 236.201, 157.378, 
		88.3286, 82.8874, 203.756, 201.045, 210.334, 128.872, 92.7919, 
		69.5552, 0};
	double r3_z_list_5[37] = {507.363, 495.995, 502.982, 542.795, 534.861, 479.959, 401.01, 
		448.196, 428.989, 477.283, 410.701, 387.558, -258.821, -291.379, 
		-250.974, -256.102, -291.615, -306.117, -281.074, -257.328, -290.088, 
		-205.712, -293.549, -338.476, 165.54, 220.22, 58.1081, 91.955, 
		111.778, 48.3887, 112.644, 57.2672, 72.416, 15.4263, 15.3177, 100.456, 0};
	double r3_z_list_6[37] = {-188.081, -187.76, -119.689, -155.309, -168.326, -82.425, -117.73, 
		-140.526, -182.187, -223.547, -228.288, -318.357, 21.7879, 148.996, 
		17.7839, 50.6221, 76.9666, 87.2572, 151.692, 83.617, 117.531, 
		245.823, 167.668, 141.938, 22.005, 6.54054, 84.0796, -34.0377, 
		-101.758, 43.1708, -116.604, -71.3797, -76.451, -3.10275, -92.2968, 
		-54.6163, 0};

	double r1_x_list_1[37] = {-1423.32, -1446.49, -1423.7, -1396.53, -1387.23, -1471.15, -1345.03, 
		-1396.7, -1401.77, -1326.42, -1344.97, -1420.84, 986.282, 1011.76, 
		1019.49, 890.544, 851.428, 956.421, 1084.58, 1094.84, 950.93, 
		1013.15, 1002.2, 971.668, -252.683, -283.271, -353.488, -298.472, 
		-436.229, -478.401, -247.543, -346.721, -255.008, -297.277, -344.145, 
		-321.032, 0};
	double r1_x_list_2[37] = {1.57832, -172.491, -224.394, -81.5278, -629.064, -570.57, -530.442, 
		-609.588, -608.3, -574.458, -586.355, -649.862, 454.837, 369.068, 
		367.21, 358.179, 470.725, 405.047, 429.461, 421.293, 453.323, 
		370.256, 336.188, 382.713, -95.3226, -113.532, -152.974, -128.96, 
		-214.843, -170.601, -68.1284, -153.669, -74.8459, -61.9708, -111.779, 
		-85.7292, 0};
	double r1_x_list_3[37] = {895.593, 885.459, 944.247, 904.848, 934.305, 925.184, 899.047, 
		901.244, 958.845, 999.997, 948.663, 1021.02, -363.343, -358.873, 
		-312.136, -293.958, -362.331, -352.682, -707.454, -744.994, -665.983, 
		-620.214, -676.011, -638.804, 95.2031, 14.1644, 134.012, 110.914, 
		222.652, 193.016, 173.286, 186.982, 107.767, 281.496, 273.859, 
		236.579, 0};
	double r1_x_list_4[37] = {2062.68, 2057.44, 2142.1, 2159.55, 2115.92, 2099.3, 1701.31, 
		1707.95, 1874.85, 1819.53, 1871.69, 1905.42, -1150.75, -1054.79, 
		-967.66, -1002.26, -967.868, -992.106, -1189.41, -1157.01, -1094.56, 
		-1089.09, -1127.78, -1077.68, 324.964, 331.633, 416.88, 406.127, 
		406.656, 443.966, 237.252, 272.384, 333.398, 320.038, 360.943, 
		390.882, 0};
	double r1_x_list_5[37] = {1018.35, 1037.23, 1048.17, 1064.69, 1101.75, 1065.33, 736.026, 
		778.385, 754.676, 831.521, 796.083, 783.814, -678.376, -678.393, 
		-605.677, -578.984, -598.134, -600.219, -497.759, -437.311, -456.331, 
		-357.09, -435.146, -411.206, 204.704, 268.815, 145.003, 229.208, 
		276.296, 244.394, 92.6204, 32.9776, 94.335, 47.2864, 113.879, 191.672, 0};
	double r1_x_list_6[37] = {-980.406, -957.987, -914.243, -956.928, -995.629, -934.467, -861.61, 
		-994.008, -978.967, -1050.4, -1019.12, -1112.78, 389.003, 434.209, 
		335.408, 282.186, 376.289, 394.8, 725.372, 669.815, 604.191, 718.305, 
		634.283, 634.854, -76.5597, -91.5248, -46.2562, -137.418, -219.954, 
		-122.875, -197.424, -194.24, -211.289, -206.035, -243.503, -265.407, 0};

	double r2_x_list_1[37] = {3044.74, 3034.17, 3148.16, 3201.29, 3200.63, 3116.3, 2944.93, 
		2897.28, 2912.56, 3105.55, 2962.83, 2909.51, -1829.72, -1805.6, 
		-1728.12, -1844.31, -1914.07, -1911.95, -1929.46, -1971.55, -1992.1, 
		-1999.9, -2031.92, -2105.57, 784.83, 793.468, 714.006, 715.621, 
		573.097, 555.729, 682.767, 592.415, 664.817, 546.359, 596.102, 
		584.303, 0};
	double r2_x_list_2[37] = {2229.22, 2279.06, 2375.96, 2059.59, 1704.87, 1743.2, 1439.94, 
		1458.16, 1428.59, 1463.35, 1431.26, 1377.71, -663.779, -779.608, 
		-774.938, -796.919, -729.746, -825.354, -822.198, -833.956, -785.438, 
		-858.52, -920.075, -873.891, 374.279, 331.096, 273.692, 239.293, 
		153.954, 204.569, 339.551, 208.212, 303.564, 267.884, 262.367, 
		316.748, 0};
	double r2_x_list_3[37] = {-790.093, -892.78, -851.676, -822.093, -662.605, -805.732, -862.055, 
		-996.904, -873.452, -899.926, -788.609, -777.655, 674.484, 704.963, 
		696.531, 721.176, 685.49, 704.932, 1198.13, 1082.12, 1135.22, 
		1219.46, 1195.22, 1230.48, -288.517, -340.432, -211.1, -237.691, 
		-122.263, -142.371, -454.822, -445.658, -515.371, -342.805, -344.379, 
		-416.584, 0};
	double r2_x_list_4[37] = {-328.607, -467.342, -518.125, -518.017, -56.8298, -224.709, 
		-684.366, -823.498, -577.784, -831.056, -532.181, -403.709, 1664.03, 
		1708.12, 1739.82, 1728.1, 1820.63, 1779.22, 1780.8, 1687.44, 1607.07, 
		1779.25, 1752.55, 1893.66, -794.332, -728.107, -637.902, -645.47, 
		-648.054, -597.929, -759.575, -707.678, -599.164, -627.789, -629.976, 
		-572.896, 0};
	double r2_x_list_5[37] = {-2126.95, -2110.48, -2115.08, -2065.87, -2039.3, -2062.28, -1626.08, 
		-1545.28, -1613.13, -1551.87, -1550.43, -1592.72, 1177.99, 1149.55, 
		1151.05, 1172.79, 1204.38, 1228.07, 776.681, 817.98, 808.89, 868.158, 
		848.224, 880.36, -443.321, -379.61, -452.426, -362.501, -317.954, 
		-347.651, -252.755, -259.239, -248.058, -280.642, -209.858, -122.843, 0};
	double r2_x_list_6[37] = {1645.71, 1657.98, 1705.55, 1663.05, 1654.05, 1708.82, 1846.03,
		1775.17, 1772.32, 1722.88, 1783.88, 1639.11, -647.23, -540.065, 
		-632.488, -651.934, -635.857, -667.986, -1189.64, -1247.42, -1226.76, 
		-1129.09, -1219.56, -1285.17, 293.735, 284.227, 290.914, 191.254, 
		109.807, 208.199, 390.97, 402.555, 361.421, 417.091, 297.895, 333.291};

	double r3_x_list_1[37] = {-49.0949, -106.179, -96.4345, -129.213, -189.935, -167.364, 
		-172.733, -165.238, -195.394, -129.273, -179.119, -244.156, 136.158, 
		190.978, 246.4, 121.697, 120.797, 196.331, 219.79, 230.412, 162.949, 
		189.714, 208.151, 223.351, -91.8637, -47.5877, -79.5285, -24.5756, 
		-69.0471, -70.6064, -116.654, -184.658, -30.8271, -58.4106, -66.2459, 
		-16.1627, 0};
	double r3_x_list_2[37] = {235.687, 171.64, 179.775, 150.112, -37.8506, 131.879, 35.2803, 
		2.73493, -11.3253, 34.0429, -28.5979, -6.76388, 98.209, 23.4921, 
		45.7649, 31.2537, 142.242, 109.172, -7.05517, -5.00029, 53.219, 
		4.54087, -43.9233, 23.7468, -30.4801, -4.91576, -27.7956, -14.2427, 
		-68.5963, -19.0558, 26.5152, -62.7517, 28.5849, 35.9309, 20.7973, 
		74.3316, 0};
	double r3_x_list_3[37] = {456.984, 467.349, 477.504, 423.022, 456.602, 418.439, 437.009, 
		402.651, 481.376, 504.503, 433.091, 476.894, -138.103, -169.978, 
		-155.214, -140.31, -225.933, -256.931, -330.861, -370.174, -313.745, 
		-304.65, -370.29, -379.299, 96.3455, -7.52434, 106.232, 39.3273, 
		134.491, 66.8967, 159.357, 130.037, 27.4904, 161.674, 129.055, 28.761, 0};
	double r3_x_list_4[37] = {883.165, 839.052, 913.088, 893.634, 809.895, 809.172, 701.975, 
		727.142, 840.014, 739.391, 737.135, 748.184, -413.65, -375.834, 
		-341.452, -396.726, -407.393, -468.787, -465.264, -472.641, -474.364, 
		-495.74, -574.653, -557.088, 238.489, 207.718, 236.201, 157.378, 
		88.3286, 82.8874, 203.756, 201.045, 210.334, 128.872, 92.7919, 
		69.5552, 0};
	double r3_x_list_5[37] = {507.363, 495.995, 502.982, 542.795, 534.861, 479.959, 401.01, 
		448.196, 428.989, 477.283, 410.701, 387.558, -258.821, -291.379, 
		-250.974, -256.102, -291.615, -306.117, -281.074, -257.328, -290.088, 
		-205.712, -293.549, -338.476, 165.54, 220.22, 58.1081, 91.955, 
		111.778, 48.3887, 112.644, 57.2672, 72.416, 15.4263, 15.3177, 100.456, 0};
	double r3_x_list_6[37] = {-188.081, -187.76, -119.689, -155.309, -168.326, -82.425, -117.73, 
		-140.526, -182.187, -223.547, -228.288, -318.357, 21.7879, 148.996, 
		17.7839, 50.6221, 76.9666, 87.2572, 151.692, 83.617, 117.531, 
		245.823, 167.668, 141.938, 22.005, 6.54054, 84.0796, -34.0377, 
		-101.758, 43.1708, -116.604, -71.3797, -76.451, -3.10275, -92.2968, 
		-54.6163, 0};

	double r1_y_list_1[37] = {126.193, 71.4486, 140.134, 83.9148, 60.7913, 32.4593, -140.687, 
		-139.005, -167.164, -111.158, -170.128, -156.901, -224.607, -147.25, 
		-105.459, -185.343, -239.108, -144.807, 180.813, 149.906, 83.8685, 
		107.475, 123.059, 104.585, 63.4408, 92.4997, 87.1123, 102.379, 
		7.67764, 28.7768, -28.6245, -181.767, -49.7126, -48.3338, -47.8061, 
		2.26356, 0};
	double r1_y_list_2[37] = {265.472, -28.5343, -123.757, 419.854, -557.949, -500.719, -850.013, 
		-883.269, -880.312, -860.091, -812.537, -853.94, 502.935, 406.011, 
		433.898, 405.18, 503.247, 424.477, 948.275, 873.883, 925.706, 
		864.007, 841.223, 913.474, -113.656, -121.168, -185.296, -153.534, 
		-249.004, -154.373, -223.516, -320.157, -272.158, -267.872, -343.816, 
		-271.67, 0};
	double r1_y_list_3[37] = {-867.84, -904.329, -843.082, -881.976, -718.835, -725.66, -967.493, 
		-1047.17, -969.83, -938.308, -942.574, -909.551, 1007.93, 1010.82, 
		998.749, 1005.74, 909.976, 879.996, 924.662, 820.925, 852.911, 
		875.839, 895.393, 875.76, -296.965, -390.089, -279.487, -400.234, 
		-282.893, -370.688, -209.379, -237.595, -316.578, -168.711, -243.828, 
		-298.782, 0};
	double r1_y_list_4[37] = {-95.5833, -95.4574, -46.4072, -79.8439, -85.5286, -132.327, 83.6759, 
		70.4787, 162.255, 124.236, 126.074, 119.722, 148.365, 197.104, 
		240.074, 179.353, 207.103, 186.857, -169.429, -166.668, -157.43, 
		-168.02, -173.442, -137.567, -12.6734, -20.9971, -8.74749, -24.7165, 
		-35.4034, -61.5709, 25.694, 77.5931, 105.796, 57.3333, 45.9767, 
		61.9631, 0};
	double r1_y_list_5[37] = {1529.57, 1475.18, 1547.37, 1591.38, 1625.08, 1655.08, 1426., 
		1499.11, 1455.83, 1582.89, 1537.51, 1529.73, -820.148, -791.892, 
		-729.108, -723.497, -713.832, -709.978, -1083.7, -1009.41, -1002.31, 
		-915.333, -945.866, -972.37, 236.089, 284.594, 178.547, 243.576, 
		330.874, 298.513, 231.901, 185.531, 226.761, 278.956, 322.681, 
		434.039, 0};
	double r1_y_list_6[37] = {1560.51, 1617.92, 1659.52, 1680.89, 1643.92, 1683.55, 1449.5, 
		1370.93, 1386.66, 1339.71, 1395.83, 1343.26, -1018.44, -827.694, 
		-942.62, -888.458, -820.365, -823.732, -855.34, -881.168, -855.26, 
		-735.949, -752.941, -842.091, 283.39, 313.413, 338.061, 273.017, 
		251.92, 411.016, 143.904, 199.845, 89.5694, 234.316, 219.843, 299.09, 0};

	double r2_y_list_1[37] = {-111.108, -134.517, -144.841, -196.511, -192.645, -225.245, 172.887, 
		197.863, 193.689, 236.954, 196.268, 152.188, 264.954, 329.809, 
		387.248, 248.516, 211.487, 325.07, -233.615, -232.611, -338.403, 
		-236.551, -274.019, -284.524, -94.2307, -40.2636, -114.335, -48.6673, 
		-145.468, -164.807, 95.0216, -9.12122, 114.578, 97.6827, 110.988, 
		139.511, 0};
	double r2_y_list_2[37] = {3310.91, 3258.41, 3511.38, 3073.15, 2786.12, 2717.62, 2814.62, 
		2848.97, 2844.78, 2917.1, 2896.27, 2862.5, -737.363, -899.482, 
		-858.087, -917.425, -818.221, -960.873, -1969.68, -1964.31, -1872.59, 
		-1929.59, -2069.56, -2028.38, 460.913, 417.241, 308.573, 275.225, 
		158.751, 218.291, 755.272, 606.846, 695.303, 705.272, 565.703, 721.25, 0};
	double r2_y_list_3[37] = {3316.86, 3265.86, 3401.32, 3304.81, 3322.14, 3316.82, 2682.86, 
		2675.03, 2790.05, 2841.29, 2758.9, 2726.58, -1783.31, -1795.4, 
		-1719.93, -1727.89, -1893.85, -1896.19, -1763.81, -1784.59, -1714.36, 
		-1688.15, -1756., -1817.2, 687.836, 517.081, 639.351, 547.008, 
		647.578, 577.217, 565.51, 504.933, 398.08, 586.565, 500.398, 397.584, 0};
	double r2_y_list_4[37] = {178.811, 108.263, 207.229, 194.127, 132.233, 121.459, -267.539, 
		-266.472, -144.317, -233.853, -200.836, -242.523, -371.12, -301.874, 
		-243.594, -247.703, -292.482, -313.59, 218.149, 272.688, 252.668, 
		283.318, 205.999, 273.16, 139.941, 113.169, 192.406, 130.917, 
		83.1807, 114.601, -138.548, -128.577, -51.8393, -137.99, -127.097, 
		-114.857, 0};
	double r2_y_list_5[37] = {-2864.17, -2878.43, -2848.4, -2682.42, -2720.25, -2787.89, -2801.98, 
		-2663.44, -2824.54, -2663.76, -2647.91, -2801.08, 1398.73, 1361.66, 
		1358.67, 1369.87, 1456.76, 1478.76, 1878.48, 1905.16, 1901.29, 
		2002.08, 1928.4, 2068.35, -529.884, -460.184, -540., -440.126, 
		-355.006, -417.102, -696.219, -722.695, -612.079, -682.915, -630.094, 
		-458.441, 0};
	double r2_y_list_6[37] = {-2404.52, -2292.46, -2182.61, -2219.34, -2153.27, -2140.52, 
		-2174.81, -2289.79, -2301.52, -2370.62, -2258.15, -2333.17, 1670.16, 
		1835.93, 1701.48, 1534.63, 1840.29, 1893.43, 1677.2, 1598.41, 
		1611.36, 1744.19, 1715.83, 1749.84, -674.013, -633.351, -483.013, 
		-541.305, -693.593, -437.514, -586.994, -519.245, -562.183, -407.558, 
		-483.45, -464.129, 0};

	double r3_y_list_1[37] = {93.5734, 94.7916, 108.734, 81.8264, 82.6549, 30.1745, -101.091, 
		-116.095, -85.5226, -99.0246, -120.206, -119.702, -153.904, -106.871, 
		-92.228, -150.911, -187.552, -114.985, 95.746, 139.103, 67.1672, 
		166.031, 113.42, 87.6178, 49.7286, 92.4467, 50.4785, 98.1642, 
		31.6812, 18.2551, -72.5916, -135.222, -16.4193, -55.9687, -63.6893, 
		8.50713, 0};
	double r3_y_list_2[37] = {386.112, -99.6085, -282.06, 252.433, -553.47, -508.946, -831.923, 
		-934.021, -905.06, -906.85, -848.779, -924.332, 334.396, 361.485, 
		380.692, 367.759, 546.533, 558.743, 846.764, 871.201, 905.872, 
		883.252, 920.752, 1032.9, -292.114, -204.611, -182.223, -118.568, 
		-73.5263, -4.57433, -356.684, -424.173, -257.634, -190.709, -179.736, 
		-125.437, 0};
	double r3_y_list_3[37] = {-844.167, -929.817, -849.745, -824.861, -758.782, -826.17, -985.038, 
		-1023.94, -936.879, -958.449, -885.07, -882.495, 743.616, 795.12, 
		827.069, 877.399, 896.411, 946.928, 742.527, 711.708, 778.08, 
		839.434, 881.189, 948.545, -452.137, -447.721, -295.65, -255.623, 
		-163.993, -129.639, -347.205, -301.857, -336.554, -172.587, -139.722, 
		-142.449, 0};
	double r3_y_list_4[37] = {-61.4845, -76.7743, -57.4344, -51.3612, -69.6358, -98.0676, 110.888, 
		110.809, 161.35, 122.473, 143.981, 109.985, 128.324, 179.36, 180.395, 
		178.184, 163.346, 170.028, -123.322, -134.494, -130.579, -141.654, 
		-159.05, -165.36, -58.6254, -37.7525, -26.1375, -23.4809, -41.12, 
		-43.0921, 43.6527, 52.3488, 100.721, 54.517, 68.1542, 68.4634, 0};
	double r3_y_list_5[37] = {1445.43, 1434.08, 1435.71, 1482.51, 1441.52, 1407.48, 1420.16, 
		1416.2, 1420.71, 1413.18, 1379.63, 1382.69, -617.478, -665.287, 
		-645.37, -657.818, -722.856, -766.51, -935.255, -920.206, -963.566, 
		-925.255, -1055.06, -1106.1, 415.841, 341.621, 224.837, 228.134, 
		186.776, 91.9632, 471.502, 370.993, 334.063, 225.65, 191.945, 208.965, 0};
	double r3_y_list_6[37] = {1522.52, 1555.73, 1611.58, 1553.67, 1543.08, 1551.34, 1421.78, 
		1389.52, 1416.43, 1264.87, 1322.05, 1213.57, -767.524, -715.93, 
		-772.011, -895.73, -837.157, -906.302, -744.055, -809.55, -802.79, 
		-753.534, -860.521, -933.171, 442.049, 416.065, 355.328, 224.89, 
		125.249, 149.61, 326.629, 305.221, 203.409, 230.19, 180.101, 100.771, 0};


	double r1_cy_list[37] = {38.9, 21.72, -9.59, -27.89, -43.74, -64.49, -1.33, -21.58, -40.09, 
		-65.38, -85.45, -105.26, -22.51, -9.31, -6.03, -5.47, -17.01, -2.62, 44.77, 54.96, 49.08, 
		44.79, 44.47, 49.55, 1.36, -7.28, 9.59, 6.89, 21.71, 5.38, -9.93, -22.23, -2.34, -20.87, 
		-11.66, -25.62, 237.82};
	double r2_cy_list[37] = {39.62, 46.81, 40.17, 27.57, 46.58, 41.33, 181.06, 186.56, 174.16, 
		173.99, 176.5, 187.57, 147.16, 123.0, 73.37, 44.83, 1.08, -7.08, -87.43, -121.46, -153.98, 
		-186.49, -227.14, -262.69, -25.45, -24.94, -21.42, -15.19, -3.57, -21.2, 78.03, 69.78, 
		94.22, 71.62, 90.84, 76.26, 687.95};
	double r3_cy_list[37] = {-73.44, -68.95, -69.77, -66.82, -67.4, -62.19, -134.94, -142.8, 
		-129.23, -125.95, -126.79, -129.27, -43.61, -32.3, -31.2, -35.08, -34.06, -27.42, 83.01, 
		99.52, 101.57, 85.7, 97.66, 103.64, 138.29, 75.28, 44.66, -33.25, -54.55, -98.94, 87.38, 
		11.59, -14.88, -63.26, -104.74, -151.1, -1215.61};

	// positions with may_2018_engineers alignment, calculated by Latif Kabir with coatjava 5c.6.9
	// in October 2018
	double sector_1_list[37] = {893.66, 930.71, 940.31, 923.36, 899.27, 849.3, 892.72, 878.03, 
		840.91, 817.05, 773.47, 782.62, -364.92, -374.89, -398.32, -445.76, -477.66, -508.96, 
		-499.85, -507.88, -535.52, -468.22, -539.05, -525.98, 176.02, 299.1, 119.0, 217.2, 80.61, 
		278.85, 114.55, 274.84, 156.54, 235.11, 85.16, 228.9, 36600.0};
	double sector_2_list[37] = {2031.36, 2223.43, 1923.65, 1748.79, 1570.44, 1550.43, 1433.84, 
		1410.67, 1418.26, 1394.3, 1304.7, 1246.63, -407.3, -405.97, -459.85, -549.73, -578.49, 
		-641.65, -823.21, -810.0, -932.61, -887.72, -940.09, -915.88, 277.22, 369.13, 140.73, 
		251.16, 46.59, 158.02, 346.76, 426.04, 270.24, 354.14, 192.71, 275.81, 39400.0};
	double sector_3_list[37] = {1578.47, 1572.34, 1626.18, 1604.2, 1560.11, 1533.06, 1453.68, 
		1412.44, 1435.55, 1404.79, 1333.29, 1331.6, -701.19, -745.18, -803.38, -843.44, -868.77, 
		-842.84, -874.92, -843.65, -938.23, -890.95, -967.45, -948.65, 304.11, 449.81, 237.04, 
		384.81, 151.14, 303.37, 292.05, 383.88, 247.22, 342.43, 190.97, 314.14, 31000.0};
	double sector_4_list[37] = {1094.01, 1133.17, 1143.98, 1133.1, 1125.19, 1111.25, 1014.19, 
		1041.32, 1003.56, 970.18, 943.05, 966.01, -574.85, -547.84, -552.46, -555.51, -568.25, 
		-549.68, -586.5, -591.15, -627.22, -594.7, -618.49, -613.13, 146.98, 293.15, 119.81, 
		286.71, 146.14, 278.04, 87.35, 237.83, 109.62, 254.31, 166.3, 291.0, 20733.33};
	double sector_5_list[37] = {-509.26, -492.97, -494.57, -512.46, -537.98, -544.52, -402.56, 
		-414.34, -440.96, -443.28, -483.73, -453.98, 270.6, 285.92, 210.89, 255.25, 235.05, 244.23, 
		279.33, 282.66, 176.46, 293.95, 219.29, 241.61, -109.59, 34.3, -110.23, 0.29, -156.26, 
		36.38, -142.88, 19.51, -94.9, 25.55, -69.62, 41.69, 36600.0};
	double sector_6_list[37] = {-116.17, -69.08, -100.33, -106.59, -100.07, -129.02, -38.6, -82.43, 
		-107.55, -143.37, -125.24, -122.67, 17.96, 47.13, 13.52, -73.23, 54.27, 63.98, 40.06, 
		41.09, 4.42, 48.13, 38.96, 63.77, -26.87, 90.12, -24.95, 100.49, -36.38, 93.53, -112.16, 
		88.37, -55.43, 53.51, -40.5, 141.24, 40333.33};

	double current_position;
	if (sector == 1) {
		current_position = sector_1_list[i];
	} else if (sector == 2)	{
		current_position = sector_2_list[i];
	} else if (sector == 3) {
		current_position = sector_3_list[i];
	} else if (sector == 4) {
		current_position = sector_4_list[i];
	} else if (sector == 5) {
		current_position = sector_5_list[i];
	} else if (sector == 6) {
		current_position = sector_6_list[i];
	}

	// desired vertex position is actually the position of the downstream target wall
	double desired_positions[37] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 30600.0};

	double value;
	if (i < 35) {
		if (sector==1) {
			value = ((1/shift)*(par[0]*r1_x_list_1[i]+par[1]*r1_y_list_1[i]+par[2]*r1_z_list_1[i]+
				par[3]*r2_x_list_1[i]+par[4]*r2_y_list_1[i]+par[5]*r2_z_list_1[i]+par[6]*r3_x_list_1[i]+
				par[7]*r3_y_list_1[i]+par[8]*r3_z_list_1[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		} else if (sector==2) {
			value = ((1/shift)*(par[0]*r1_x_list_2[i]+par[1]*r1_y_list_2[i]+par[2]*r1_z_list_2[i]+
				par[3]*r2_x_list_2[i]+par[4]*r2_y_list_2[i]+par[5]*r2_z_list_2[i]+par[6]*r3_x_list_2[i]+
				par[7]*r3_y_list_2[i]+par[8]*r3_z_list_2[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		} else if (sector==3) {
			value = ((1/shift)*(par[0]*r1_x_list_3[i]+par[1]*r1_y_list_3[i]+par[2]*r1_z_list_3[i]+
				par[3]*r2_x_list_3[i]+par[4]*r2_y_list_3[i]+par[5]*r2_z_list_3[i]+par[6]*r3_x_list_3[i]+
				par[7]*r3_y_list_3[i]+par[8]*r3_z_list_3[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		} else if (sector==4) {
			value = ((1/shift)*(par[0]*r1_x_list_4[i]+par[1]*r1_y_list_4[i]+par[2]*r1_z_list_4[i]+
				par[3]*r2_x_list_4[i]+par[4]*r2_y_list_4[i]+par[5]*r2_z_list_4[i]+par[6]*r3_x_list_4[i]+
				par[7]*r3_y_list_4[i]+par[8]*r3_z_list_4[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		} else if (sector==5) {
			value = ((1/shift)*(par[0]*r1_x_list_5[i]+par[1]*r1_y_list_5[i]+par[2]*r1_z_list_5[i]+
				par[3]*r2_x_list_5[i]+par[4]*r2_y_list_5[i]+par[5]*r2_z_list_5[i]+par[6]*r3_x_list_5[i]+
				par[7]*r3_y_list_5[i]+par[8]*r3_z_list_5[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		} else if (sector==6) {
			value = ((1/shift)*(par[0]*r1_x_list_6[i]+par[1]*r1_y_list_6[i]+par[2]*r1_z_list_6[i]+
				par[3]*r2_x_list_6[i]+par[4]*r2_y_list_6[i]+par[5]*r2_z_list_6[i]+par[6]*r3_x_list_6[i]+
				par[7]*r3_y_list_6[i]+par[8]*r3_z_list_6[i])+(1/rot)*(par[9]*r1_cy_list[i]+
				par[10]*r2_cy_list[i]+par[11]*r3_cy_list[i]))-current_position;
		}
	} else { // rotations change vertex position by a negligible amount
		value = ((1/shift)*(par[0]*r1_x_list_1[i]+par[1]*r1_y_list_1[i]+par[2]*r1_z_list[i]+
		par[3]*r2_x_list_1[i]+par[4]*r2_y_list_1[i]+par[5]*r2_z_list[i]+par[6]*r3_x_list_1[i]+
		par[7]*r3_y_list_1[i]+par[8]*r3_z_list[i]))+current_position-desired_positions[i];
	}

	return value;
}

void chi2(int &npar, double *gin, double &f, double *par, int iflag) {
	//calculate chisquare
	double chisq = 0;
	// loop over all layers and vertex position (36 layers + 1 vertex) 
	// sector = 1;
	for (int i = 0; i < 35; ++i) {
		// each value weighted equally, so no division by uncertainty, maybe adjust later?
		chisq += pow(calculate_residual(sector, i, par), 2);
	}
	f = chisq; 
}

void minimizer_0004() {

	for (int cur_sector = 1; cur_sector < 7; ++cur_sector) {
		TMinuit *gMinuit = new TMinuit(12);  //initialize TMinuit with a maximum of 12 params
		gMinuit->SetPrintLevel(0);
		gMinuit->SetFCN(chi2); // chi^2 function to be minimized
		double arglist[10]; arglist[0] = 1;
		int ierflg = 0;
		gMinuit->mnexcm("SET ERR", arglist, 1, ierflg);
		// Set starting values and step sizes for parameters
		// (param int, name, start value, step size, min limit, upper limit, error flag)
		gMinuit->mnparm(0, "r1x", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(1, "r1y", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(2, "r1z", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(3, "r1cy", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(4, "r2x", 0, 0.1, 0, 0, ierflg);
		gMinuit->mnparm(5, "r2y", 0, 0.1, 0, 0, ierflg);
		gMinuit->mnparm(6, "r2z", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(7, "r2cy", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(8, "r3x", 0, 0.1, 0, 0, ierflg);
		gMinuit->mnparm(9, "r3y", 0, 0.1, 0, 0, ierflg);
		gMinuit->mnparm(10, "r3z", 0, 0, 0, 0, ierflg);
		gMinuit->mnparm(11, "r3cy", 0, 0, 0, 0, ierflg);

		arglist[1] = 1.0; arglist[0] = 50000;
		gMinuit->mnexcm("MIGRAD", arglist, 2, ierflg);

		// sector++;

	}
	// TMinuit *gMinuit = new TMinuit(12);  //initialize TMinuit with a maximum of 12 params
	// gMinuit->SetPrintLevel(0);
	// gMinuit->SetFCN(chi2); // chi^2 function to be minimized
	// double arglist[10]; arglist[0] = 1;
	// int ierflg = 0;
	// gMinuit->mnexcm("SET ERR", arglist, 1, ierflg);
	// // Set starting values and step sizes for parameters
	// // (param int, name, start value, step size, min limit, upper limit, error flag)
	// gMinuit->mnparm(0, "r1x", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(1, "r1y", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(2, "r1z", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(3, "r1cy", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(4, "r2x", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(5, "r2y", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(6, "r2z", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(7, "r2cy", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(8, "r3x", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(9, "r3y", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(10, "r3z", 0, 0.001, 0, 0, ierflg);
	// gMinuit->mnparm(11, "r3cy", 0, 0.001, 0, 0, ierflg);

	// arglist[1] = 1.0; arglist[0] = 5000;
	// gMinuit->mnexcm("MIGRAD", arglist, 2, ierflg);
}